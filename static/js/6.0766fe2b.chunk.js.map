{"version":3,"sources":["service/position.ts","service/storage.ts","service/server.ts","component/Map.tsx","component/ProducerMarker.tsx","component/SellerMarker.tsx","view/Map.tsx","model/producer.ts","model/seller.ts"],"names":["usePosition","callback","useState","position","setPosition","useEffect","navigator","geolocation","getCurrentPosition","current","coords","latitude","longitude","console","warn","useStoredState","key","defaultValue","value","result","window","localStorage","getItem","JSON","parse","err","state","setState","useCallback","changed","setItem","stringify","get","url","fetch","then","res","status","json","Error","statusText","useStyles","makeStyles","root","top","right","bottom","left","CustomMap","children","onChangePosition","classes","zoom","setZoom","handleMoveEnd","event","center","target","getCenter","lat","lng","handleZoomEnd","getZoom","handleMoveEndDebounce","useDebounceCallback","handleZoomEndDebounce","Map","className","onMoveEnd","onZoomEnd","TileLayer","producerIcon","L","Icon","iconAnchor","iconSize","iconUrl","ProducerMarker","props","Marker","icon","producer","sellerIcon","SellerMarker","seller","onClick","handleClick","SellerDialog","React","lazy","MapView","currentPosition","mapPosition","producers","setProducers","catch","useProducers","sellers","setSellers","useSellers","selectedSeller","setSelectedSeller","Fragment","map","id","Suspense","fallback","onClose","undefined"],"mappings":"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","file":"static/js/6.0766fe2b.chunk.js","sourcesContent":["import { LatLngTuple } from 'leaflet';\nimport { useEffect, useState } from 'react';\n\nexport type PositionCallback = (value: LatLngTuple) => any | undefined;\n\nexport const usePositionEffect = function(callback: PositionCallback) {\n  useEffect(() => {\n    if (!navigator.geolocation) {\n      console.warn('Geolocation is not supported');\n      return;\n    }\n\n    navigator.geolocation.getCurrentPosition((current) => {\n      callback([current.coords.latitude, current.coords.longitude]);\n    });\n  }, [callback]);\n};\n\nexport const usePosition = function(): LatLngTuple | undefined {\n  const [position, setPosition] = useState<LatLngTuple>();\n\n  usePositionEffect(setPosition);\n\n  return position;\n};\n","import { useCallback, useState } from 'react';\n\nexport const getItem = function<T>(key: string, defaultValue?: T): T | undefined {\n  const result = window.localStorage.getItem(key);\n  if (!result) {\n    return defaultValue;\n  }\n  try {\n    return JSON.parse(result) as T;\n  } catch (err) {\n    console.warn(err);\n    return defaultValue;\n  }\n};\n\nexport const setItem = function(key: string, value: any) {\n  window.localStorage.setItem(key, JSON.stringify(value));\n};\n\nexport const useStoredState = function<T>(\n  key: string,\n  defaultValue?: T,\n): [T | undefined, React.Dispatch<React.SetStateAction<T>>] {\n  const value = getItem(key, defaultValue);\n  const [state, setState] = useState(value);\n  const setValue = useCallback(\n    (changed) => {\n      setState(changed);\n      setItem(key, changed);\n    },\n    [key, setState],\n  );\n  return [state, setValue];\n};\n","export const get = function(url: string): Promise<any> {\n  return fetch(url).then((res) => {\n    if (res.status >= 200 && res.status < 400) {\n      return res.json();\n    }\n    throw new Error(res.statusText);\n  });\n};\n","import React, { useCallback, useState, ReactNode } from 'react';\nimport { useDebounceCallback } from '@react-hook/debounce';\nimport { LatLngTuple } from 'leaflet';\nimport { Map, TileLayer } from 'react-leaflet';\nimport { makeStyles } from '@material-ui/core/styles';\nimport 'leaflet/dist/leaflet.css';\n\nexport type CustomMapType = {\n  children?: ReactNode;\n  onChangePosition: (position: LatLngTuple) => any | undefined;\n  position: LatLngTuple;\n};\n\nconst useStyles = makeStyles(() => ({\n  root: {\n    position: 'fixed',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n  },\n}));\n\nconst CustomMap: React.FC<CustomMapType> = ({ children, onChangePosition, position }) => {\n  const classes = useStyles();\n\n  const [zoom, setZoom] = useState(13);\n\n  const handleMoveEnd = useCallback(\n    (event) => {\n      const center = event.target.getCenter();\n      onChangePosition([center.lat, center.lng]);\n    },\n    [onChangePosition],\n  );\n\n  const handleZoomEnd = useCallback((event) => setZoom(event.target.getZoom()), [setZoom]);\n\n  const handleMoveEndDebounce = useDebounceCallback(handleMoveEnd, 250);\n  const handleZoomEndDebounce = useDebounceCallback(handleZoomEnd, 250);\n\n  return (\n    <Map\n      className={classes.root}\n      center={position}\n      onMoveEnd={handleMoveEndDebounce}\n      onZoomEnd={handleZoomEndDebounce}\n      zoom={zoom}\n    >\n      <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\n      {children}\n    </Map>\n  );\n};\n\nexport default CustomMap;\n","import React from 'react';\nimport L from 'leaflet';\nimport { Marker } from 'react-leaflet';\nimport { Producer } from '../model/producer';\n\nexport type ProducerMarkerProps = {\n  producer: Producer;\n};\n\nexport const producerIcon = new L.Icon({\n  iconAnchor: [0, 0],\n  iconSize: [32, 32],\n  iconUrl: 'image/040-farmer.svg',\n});\n\nconst ProducerMarker: React.FC<ProducerMarkerProps> = function(props) {\n  return <Marker icon={producerIcon} position={props.producer.position} />;\n};\n\nexport default ProducerMarker;\n","import React, { useCallback } from 'react';\nimport L from 'leaflet';\nimport { Marker } from 'react-leaflet';\nimport { Seller } from '../model/seller';\n\nexport type SellerMarkerProps = {\n  seller: Seller;\n  onClick: (value: Seller) => any;\n};\n\nexport const sellerIcon = new L.Icon({\n  iconAnchor: [0, 0],\n  iconSize: [32, 32],\n  iconUrl: 'image/033-stall.svg',\n});\n\nconst SellerMarker: React.FC<SellerMarkerProps> = function({ seller, onClick }) {\n  const handleClick = useCallback(() => onClick(seller), [onClick, seller]);\n  return <Marker icon={sellerIcon} onClick={handleClick} position={seller.position} />;\n};\n\nexport default SellerMarker;\n","import React, { useState } from 'react';\nimport { LatLngTuple } from 'leaflet';\n\nimport { usePosition } from '../service/position';\nimport { useStoredState } from '../service/storage';\nimport { useProducers } from '../model/producer';\nimport { useSellers, Seller } from '../model/seller';\nimport CustomMap from '../component/Map';\nimport ProducerMarker from '../component/ProducerMarker';\nimport SellerMarker from '../component/SellerMarker';\n\nconst SellerDialog = React.lazy(() => import('../component/SellerDialog'));\n\nconst MapView: React.FC = function() {\n  const [position, setPosition] = useStoredState<LatLngTuple>('position');\n  const currentPosition = usePosition();\n  const mapPosition = position || currentPosition || [51.505, -0.09];\n\n  const producers = useProducers();\n  const sellers = useSellers();\n\n  const [selectedSeller, setSelectedSeller] = useState<Seller>();\n\n  return (\n    <React.Fragment>\n      <CustomMap position={mapPosition} onChangePosition={setPosition}>\n        {sellers?.map((seller) => (\n          <SellerMarker key={seller.id} seller={seller} onClick={setSelectedSeller} />\n        ))}\n        {producers?.map((producer) => (\n          <ProducerMarker key={producer.id} producer={producer} />\n        ))}\n      </CustomMap>\n      <React.Suspense fallback={null}>\n        <SellerDialog seller={selectedSeller} onClose={() => setSelectedSeller(undefined)} />\n      </React.Suspense>\n    </React.Fragment>\n  );\n};\n\nexport default MapView;\n","import { useState, useEffect } from 'react';\nimport { get } from '../service/server';\nimport { Entity } from './entity';\n\nexport type Producer = Entity;\n\nexport const useProducers = function(): Producer[] | undefined {\n  const [producers, setProducers] = useState();\n\n  useEffect(() => {\n    get('api/producers/list.json')\n      .then(setProducers)\n      .catch(console.warn);\n  }, [setProducers]);\n\n  return producers;\n};\n","import { useState, useEffect } from 'react';\nimport { get } from '../service/server';\nimport { Entity } from './entity';\n\nexport type Seller = Entity;\n\nexport const useSellers = function(): Seller[] | undefined {\n  const [sellers, setSellers] = useState();\n\n  useEffect(() => {\n    get('api/sellers/list.json')\n      .then(setSellers)\n      .catch(console.warn);\n  }, [setSellers]);\n\n  return sellers;\n};\n"],"sourceRoot":""}